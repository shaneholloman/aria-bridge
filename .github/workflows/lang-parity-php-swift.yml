name: lang-parity-php-swift

on:
  push:
  pull_request:

jobs:
  python-parity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install deps
        working-directory: python
        run: |
          pip install -r requirements.txt
          pip install -e .
      - name: Run Python parity tests
        working-directory: python
        run: python -m pytest

  ruby-parity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
      - name: Install ws for protocol host
        run: npm install ws@8
        working-directory: ruby/tests
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.2'
          bundler-cache: true
          working-directory: ruby
      - name: Run Ruby parity tests
        working-directory: ruby
        run: bundle exec ruby -Ilib tests/test_client.rb

  rust-parity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          profile: minimal
          override: true
      - name: Run Rust parity tests
        working-directory: rust
        run: cargo test

  java-parity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
      - name: Install ws for protocol host
        run: npm install ws@8
        working-directory: java/src/test/resources
      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'
          cache: maven
      - name: Run Java parity tests
        working-directory: java
        run: mvn -q test

  php-parity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
      - name: Install ws for protocol host
        run: npm install ws@8
        working-directory: php/tests
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'
          coverage: none
      - name: Install dependencies
        working-directory: php
        run: composer install --no-interaction --prefer-dist
      - name: Run PHPUnit parity suite
        working-directory: php
        run: ./vendor/bin/phpunit

  swift-parity:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
      - name: Install ws for protocol host
        run: npm install ws@8
        working-directory: swift/Tests
      - name: Run Swift parity tests
        working-directory: swift
        run: swift test

  go-parity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.22.x'
      - name: Run Go parity tests
        working-directory: go
        run: go test ./...
